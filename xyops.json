{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"xyops": "0.9.68",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "hlth1healthcare",
				"title": "Healthcare",
				"enabled": true,
				"type": "event",
				"command": "pwsh",
				"script": "#requires -Version 7.0\n# Copyright (c) 2026 Tim Alderweireldt. All rights reserved.\n<#!\nxyOps Healthcare Event Plugin (PowerShell 7)\nHealthcare interoperability tools for xyOps:\n- HL7 Message Generator (v2.x messages with fake or custom data)\n- HL7 Message Parser (parse, analyze, validate HL7 messages)\n\nI/O contract:\n- Read one JSON object from STDIN (job), write progress/messages as JSON lines of the\n  form: { \"xy\": 1, ... } to STDOUT.\n- On success, emit: { \"xy\": 1, \"code\": 0, \"data\": <result>, \"description\": \"...\" }\n- On error, emit:   { \"xy\": 1, \"code\": <nonzero>, \"description\": \"...\" } and exit 1.\n\nTest locally:\n  pwsh -NoProfile -ExecutionPolicy Bypass -File .\\healthcare.ps1 < job.json\n#>\n\nSet-StrictMode -Version Latest\n$ErrorActionPreference = 'Stop'\n\nfunction Write-XY {\n  param([hashtable]$Object)\n  $payload = [ordered]@{ xy = 1 }\n  foreach ($k in $Object.Keys) { $payload[$k] = $Object[$k] }\n  [Console]::Out.WriteLine(($payload | ConvertTo-Json -Depth 20 -Compress))\n  [Console]::Out.Flush()\n}\n\nfunction Write-XYProgress {\n  param([double]$Value, [string]$Status)\n  $o = @{ progress = [math]::Round($Value, 4) }\n  if ($Status) { $o.status = $Status }\n  Write-XY $o\n}\n\nfunction Write-XYSuccess {\n  param($Data, [string]$Description)\n  $o = @{ code = 0; data = $Data }\n  if ($Description) { $o.description = $Description }\n  Write-XY $o\n}\n\nfunction Write-XYError {\n  param([int]$Code, [string]$Description)\n  Write-XY @{ code = $Code; description = $Description }\n}\n\nfunction Read-JobFromStdin {\n  $raw = [Console]::In.ReadToEnd()\n  if ([string]::IsNullOrWhiteSpace($raw)) { throw 'No job JSON received on STDIN' }\n  return $raw | ConvertFrom-Json -ErrorAction Stop\n}\n\nfunction Get-NestedValue {\n  param($Object, [string]$Path)\n  if (-not $Path -or ($Path.Trim() -eq '')) { return $Object }\n  $cur = $Object\n  foreach ($part in $Path.Split('.')) {\n    if ($null -eq $cur) { return $null }\n    if ($cur -is [System.Collections.IDictionary]) {\n      if (-not $cur.Contains($part)) { return $null }\n      $cur = $cur[$part]\n    }\n    else {\n      $cur = $cur.PSObject.Properties[$part].Value\n    }\n  }\n  return $cur\n}\n\nfunction Get-Param {\n  param($Params, [string]$Name, $Default = $null)\n  if ($null -ne $Params -and $null -ne $Params.PSObject -and $Params.PSObject.Properties.Name -contains $Name) { return $Params.$Name }\n  return $Default\n}\n\nfunction Get-RandomBytes {\n  param([int]$Length)\n  $data = New-Object byte[] ($Length)\n  [void][System.Security.Cryptography.RandomNumberGenerator]::Fill($data)\n  return $data\n}\n\nfunction Get-SecureRandomInt {\n  [OutputType([int])]\n  param([int]$Max)\n  # Use Get-Random for reliability (still cryptographically seeded in PS7)\n  return [int](Get-Random -Maximum $Max)\n}\n\nfunction Get-SecureRandomString {\n  [OutputType([string])]\n  param([int]$Length)\n  $chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n  $sb = [System.Text.StringBuilder]::new($Length)\n  for ([int]$i = 0; $i -lt $Length; $i++) {\n    [int]$idx = Get-SecureRandomInt $chars.Length\n    [void]$sb.Append($chars[$idx])\n  }\n  return $sb.ToString()\n}\n\n# ------------------------- HL7 Message Generator -------------------------\nfunction Invoke-HL7Generator {\n  param($Params, $JobInput, [string]$Cwd)\n  Write-XYProgress 0.1 'Validating parameters...'\n  \n  $messageType = (Get-Param $Params 'hl7MessageType' 'ADT')\n  $userEventType = (Get-Param $Params 'hl7EventType' '')\n  $version = '2.5.1'\n  $dataSource = (Get-Param $Params 'hl7DataSource' 'field')\n  $dataPath = (Get-Param $Params 'hl7DataPath' '')\n  \n  # Default event types per message type (HL7 v2.5.1 standard)\n  $defaultEvents = @{\n    'ADT' = 'A01'   # Admit patient\n    'ORM' = 'O01'   # General order\n    'ORU' = 'R01'   # Unsolicited observation result\n    'SIU' = 'S12'   # Notification of new appointment\n    'RDE' = 'O11'   # Pharmacy encoded order\n    'MDM' = 'T02'   # Document status change notification\n    'DFT' = 'P03'   # Post detail financial transaction\n    'VXU' = 'V04'   # Unsolicited vaccination record update\n  }\n  \n  # Valid event types per message type\n  $validEvents = @{\n    'ADT' = @('A01','A02','A03','A04','A05','A08','A11','A13','A28','A31')\n    'ORM' = @('O01')\n    'ORU' = @('R01')\n    'SIU' = @('S12','S13','S14','S15','S16','S17')\n    'RDE' = @('O11','O25')\n    'MDM' = @('T01','T02','T03','T04','T05','T06','T07','T08','T09','T10','T11')\n    'DFT' = @('P03','P11')\n    'VXU' = @('V04')\n  }\n  \n  # Determine event type: use user selection if valid for message type, otherwise use default\n  $eventType = $defaultEvents[$messageType]\n  if ($userEventType -and $validEvents[$messageType] -contains $userEventType) {\n    $eventType = $userEventType\n  }\n  \n  $validationErrors = [System.Collections.Generic.List[string]]::new()\n  \n  # Helper to get non-empty param value or null (safe under strict mode)\n  $getField = { param($name) \n    $v = Get-Param $Params $name $null\n    if ($v -and \"$v\".Trim()) { \"$v\".Trim() } else { $null }\n  }\n  \n  # Initialize bucket data (empty hashtable if not using bucket)\n  $bucket = @{}\n  \n  if ($dataSource -eq 'bucket') {\n    $inputData = $JobInput.data\n    if (-not $inputData) {\n      $validationErrors.Add('Bucket data source selected but no input data available from previous job')\n    } else {\n      # Get data at path prefix (or root if empty)\n      $sourceData = if ($dataPath.Trim()) { Get-NestedValue $inputData $dataPath } else { $inputData }\n      if ($null -eq $sourceData) {\n        $validationErrors.Add(\"Data path '$dataPath' not found in bucket data\")\n      } else {\n        # Convert PSObject to hashtable for easy access\n        if ($sourceData -is [PSCustomObject]) {\n          $sourceData.PSObject.Properties | ForEach-Object { $bucket[$_.Name] = $_.Value }\n        } elseif ($sourceData -is [hashtable]) {\n          $bucket = $sourceData\n        }\n      }\n    }\n  }\n  \n  # Helper to get value: form field overrides bucket, bucket overrides null\n  $getValue = { param($fieldName, $bucketKey)\n    $formVal = & $getField $fieldName\n    if ($formVal) { return $formVal }\n    if ($bucket.ContainsKey($bucketKey)) { \n      $v = $bucket[$bucketKey]\n      if ($v -and \"$v\".Trim()) { return \"$v\".Trim() }\n    }\n    return $null\n  }\n  \n  # Read values (form fields override bucket data)\n  # Patient demographics\n  $inputPatientId = & $getValue 'hl7PatientId' 'patientId'\n  $inputPatientFirstName = & $getValue 'hl7PatientFirstName' 'patientFirstName'\n  $inputPatientMiddleName = & $getValue 'hl7PatientMiddleName' 'patientMiddleName'\n  $inputPatientLastName = & $getValue 'hl7PatientLastName' 'patientLastName'\n  $inputPatientDOB = & $getValue 'hl7PatientDOB' 'patientDOB'\n  $inputPatientGender = & $getValue 'hl7PatientGender' 'patientGender'\n  $inputPatientSSN = & $getValue 'hl7PatientSSN' 'patientSSN'\n  $inputPatientRace = & $getValue 'hl7PatientRace' 'patientRace'\n  $inputPatientMaritalStatus = & $getValue 'hl7PatientMaritalStatus' 'patientMaritalStatus'\n  $inputPatientAddress = & $getValue 'hl7PatientAddress' 'patientAddress'\n  $inputPatientCity = & $getValue 'hl7PatientCity' 'patientCity'\n  $inputPatientState = & $getValue 'hl7PatientState' 'patientState'\n  $inputPatientZip = & $getValue 'hl7PatientZip' 'patientZip'\n  $inputPatientPhone = & $getValue 'hl7PatientPhone' 'patientPhone'\n  # Visit information\n  $inputAttendingId = & $getValue 'hl7AttendingId' 'attendingId'\n  $inputAttendingFirstName = & $getValue 'hl7AttendingFirstName' 'attendingFirstName'\n  $inputAttendingLastName = & $getValue 'hl7AttendingLastName' 'attendingLastName'\n  $inputVisitNumber = & $getValue 'hl7VisitNumber' 'visitNumber'\n  $inputPatientClass = & $getValue 'hl7PatientClass' 'patientClass'\n  $inputAssignedLocation = & $getValue 'hl7AssignedLocation' 'assignedLocation'\n  $inputAdmitDateTime = & $getValue 'hl7AdmitDateTime' 'admitDateTime'\n  $inputDischargeDateTime = & $getValue 'hl7DischargeDateTime' 'dischargeDateTime'\n  $inputAdmitReason = & $getValue 'hl7AdmitReason' 'admitReason'\n  # Diagnosis\n  $inputDiagnosisCode = & $getValue 'hl7DiagnosisCode' 'diagnosisCode'\n  $inputDiagnosisDescription = & $getValue 'hl7DiagnosisDescription' 'diagnosisDescription'\n  # Message header\n  $inputSendingApp = & $getValue 'hl7SendingApp' 'sendingApp'\n  $inputSendingFacility = & $getValue 'hl7SendingFacility' 'sendingFacility'\n  $inputReceivingApp = & $getValue 'hl7ReceivingApp' 'receivingApp'\n  $inputReceivingFacility = & $getValue 'hl7ReceivingFacility' 'receivingFacility'\n  \n  # Validate specific field formats\n  if ($inputPatientDOB -and $inputPatientDOB -notmatch '^\\d{8}$') {\n    $validationErrors.Add(\"Patient DOB must be in YYYYMMDD format (e.g., 19850315)\")\n  }\n  if ($inputAdmitDateTime -and $inputAdmitDateTime -notmatch '^\\d{12}$') {\n    $validationErrors.Add(\"Admit Date/Time must be in YYYYMMDDHHmm format (e.g., 202601151030)\")\n  }\n  if ($inputDischargeDateTime -and $inputDischargeDateTime -notmatch '^\\d{12}$') {\n    $validationErrors.Add(\"Discharge Date/Time must be in YYYYMMDDHHmm format (e.g., 202601201400)\")\n  }\n  \n  if ($validationErrors.Count -gt 0) {\n    Write-XY @{ table = @{ title='Validation Errors'; header=@('#','Error'); rows=@(for ($n = 0; $n -lt $validationErrors.Count; $n++) { ,@(($n + 1), $validationErrors[$n]) }); caption='Please fix the errors above' } }\n    throw \"Validation failed with $($validationErrors.Count) error(s)\"\n  }\n  \n  Write-XYProgress 0.3 'Generating fake data...'\n  \n  # Gender-appropriate first names for semantic consistency\n  $maleFirstNames = @('James','John','Robert','Michael','David','William','Richard','Joseph','Thomas','Christopher')\n  $femaleFirstNames = @('Mary','Patricia','Jennifer','Linda','Elizabeth','Barbara','Susan','Jessica','Sarah','Karen')\n  $lastNames = @('Smith','Johnson','Williams','Brown','Jones','Garcia','Miller','Davis','Rodriguez','Martinez')\n  $streets = @('Main St','Oak Ave','Maple Dr','Cedar Ln','Pine Rd','Elm St','Park Ave')\n  $cities = @('New York','Los Angeles','Chicago','Houston','Phoenix','Philadelphia')\n  $states = @('NY','CA','IL','TX','AZ','PA','FL','OH','NC','WA')\n  \n  # Generate default values\n  $now = Get-Date\n  $msgControlId = Get-SecureRandomString 10\n  \n  # Handle select fields with 'random' option - determine gender first so name can match\n  $genderValue = if ($inputPatientGender -and $inputPatientGender -ne 'random') { $inputPatientGender.ToUpper() } else { @('M','F')[(Get-SecureRandomInt 2)] }\n  $raceValue = if ($inputPatientRace -and $inputPatientRace -ne 'random') { $inputPatientRace } else { @('2106-3','2054-5','2028-9','2076-8','1002-5')[(Get-SecureRandomInt 5)] }\n  $maritalValue = if ($inputPatientMaritalStatus -and $inputPatientMaritalStatus -ne 'random') { $inputPatientMaritalStatus } else { @('S','M','D','W')[(Get-SecureRandomInt 4)] }\n  $classValue = if ($inputPatientClass -and $inputPatientClass -ne 'random') { $inputPatientClass } else { @('I','O','E','P')[(Get-SecureRandomInt 4)] }\n  \n  # Select gender-appropriate first name if not provided by user\n  $defaultFirstName = if ($genderValue -eq 'F') {\n    $femaleFirstNames[(Get-SecureRandomInt $femaleFirstNames.Count)]\n  } else {\n    $maleFirstNames[(Get-SecureRandomInt $maleFirstNames.Count)]\n  }\n  \n  # Calculate random DOB (age 18-68) - hardcoded to avoid any array issues\n  [int]$birthYear = 1958 + (Get-Random -Maximum 51)\n  [int]$birthMonth = 1 + (Get-Random -Maximum 12)\n  [int]$birthDay = 1 + (Get-Random -Maximum 28)\n  [string]$defaultDOB = '{0:D4}{1:D2}{2:D2}' -f $birthYear, $birthMonth, $birthDay\n  \n  $d = @{\n    patientId = $inputPatientId ?? (Get-SecureRandomString 8)\n    patientLastName = $inputPatientLastName ?? $lastNames[(Get-SecureRandomInt $lastNames.Count)]\n    patientFirstName = $inputPatientFirstName ?? $defaultFirstName\n    patientMiddleName = $inputPatientMiddleName ?? ''\n    patientDOB = $inputPatientDOB ?? $defaultDOB\n    patientGender = $genderValue\n    patientSSN = $inputPatientSSN ?? \"$((Get-SecureRandomInt 900)+100)-$((Get-SecureRandomInt 90)+10)-$((Get-SecureRandomInt 9000)+1000)\"\n    patientAddress = $inputPatientAddress ?? \"$((Get-SecureRandomInt 9999)+1) $($streets[(Get-SecureRandomInt $streets.Count)])\"\n    patientCity = $inputPatientCity ?? $cities[(Get-SecureRandomInt $cities.Count)]\n    patientState = $inputPatientState ?? $states[(Get-SecureRandomInt $states.Count)]\n    patientZip = $inputPatientZip ?? ('{0:D5}' -f ((Get-SecureRandomInt 90000)+10000))\n    patientPhone = $inputPatientPhone ?? \"($((Get-SecureRandomInt 900)+100))$((Get-SecureRandomInt 900)+100)-$((Get-SecureRandomInt 9000)+1000)\"\n    patientRace = $raceValue\n    patientMaritalStatus = $maritalValue\n    attendingId = $inputAttendingId ?? (Get-SecureRandomString 6)\n    attendingLastName = $inputAttendingLastName ?? $lastNames[(Get-SecureRandomInt $lastNames.Count)]\n    attendingFirstName = $inputAttendingFirstName ?? $maleFirstNames[(Get-SecureRandomInt $maleFirstNames.Count)]\n    visitNumber = $inputVisitNumber ?? (Get-SecureRandomString 10)\n    admitDateTime = $inputAdmitDateTime ?? $now.ToString('yyyyMMddHHmm')\n    dischargeDateTime = $inputDischargeDateTime ?? $now.AddDays([int](Get-SecureRandomInt 5)+1).ToString('yyyyMMddHHmm')\n    patientClass = $classValue\n    assignedLocation = $inputAssignedLocation ?? \"ROOM$((Get-SecureRandomInt 500)+100)^BED$((Get-SecureRandomInt 4)+1)^FLOOR$((Get-SecureRandomInt 5)+1)\"\n    admitReason = $inputAdmitReason ?? @('Chest pain','Shortness of breath','Abdominal pain','Fever','Injury')[(Get-SecureRandomInt 5)]\n  }\n  \n  # Diagnosis data - paired code/description for consistency\n  $diagnoses = @(\n    @{ code='I10'; description='Essential hypertension' }\n    @{ code='J18.9'; description='Pneumonia, unspecified organism' }\n    @{ code='K35.80'; description='Unspecified acute appendicitis' }\n    @{ code='R50.9'; description='Fever, unspecified' }\n    @{ code='S82.90XA'; description='Unspecified fracture of lower leg, initial encounter' }\n    @{ code='I21.9'; description='Acute myocardial infarction, unspecified' }\n    @{ code='J44.1'; description='Chronic obstructive pulmonary disease with acute exacerbation' }\n    @{ code='N39.0'; description='Urinary tract infection, site not specified' }\n  )\n  $selectedDiagnosis = $diagnoses[(Get-SecureRandomInt $diagnoses.Count)]\n  $d['diagnosisCode'] = $inputDiagnosisCode ?? $selectedDiagnosis.code\n  $d['diagnosisDescription'] = $inputDiagnosisDescription ?? $selectedDiagnosis.description\n  # Add more fields to $d\n  $d += @{\n    orderNumber = Get-SecureRandomString 10\n    orderDateTime = $now.ToString('yyyyMMddHHmm')\n    orderingProviderId = Get-SecureRandomString 6\n    orderingProviderName = \"$($lastNames[(Get-SecureRandomInt $lastNames.Count)])^$($maleFirstNames[(Get-SecureRandomInt $maleFirstNames.Count)])\"\n    observationDateTime = $now.ToString('yyyyMMddHHmm')\n    observationStatus = 'F'\n  }\n  \n  # Lab test data (LOINC codes with names)\n  $labTests = @(\n    @{ id='2339-0'; name='Glucose [Mass/volume] in Blood'; shortName='Glucose'; units='mg/dL'; refLow=70; refHigh=100 }\n    @{ id='2345-7'; name='Glucose [Mass/volume] in Serum or Plasma'; shortName='Glucose'; units='mg/dL'; refLow=70; refHigh=100 }\n    @{ id='718-7';  name='Hemoglobin [Mass/volume] in Blood'; shortName='Hemoglobin'; units='g/dL'; refLow=12; refHigh=17 }\n    @{ id='2160-0'; name='Creatinine [Mass/volume] in Serum or Plasma'; shortName='Creatinine'; units='mg/dL'; refLow=0.6; refHigh=1.2 }\n    @{ id='3094-0'; name='Urea nitrogen [Mass/volume] in Serum or Plasma'; shortName='BUN'; units='mg/dL'; refLow=7; refHigh=20 }\n  )\n  $selectedLab = $labTests[(Get-SecureRandomInt $labTests.Count)]\n  $d['observationId'] = $selectedLab.id\n  $d['observationName'] = $selectedLab.name\n  $d['observationShortName'] = $selectedLab.shortName\n  $d['observationUnits'] = $selectedLab.units\n  $d['observationRefRange'] = \"$($selectedLab.refLow)-$($selectedLab.refHigh)\"\n  # Generate value that can be normal, high, or low\n  $valueVariance = Get-SecureRandomInt 3  # 0=normal, 1=high, 2=low\n  $d['observationValue'] = switch ($valueVariance) {\n    0 { [int]($selectedLab.refLow + (($selectedLab.refHigh - $selectedLab.refLow) * (Get-Random -Minimum 0.2 -Maximum 0.8))) }  # Normal\n    1 { [int]($selectedLab.refHigh + (Get-Random -Minimum 5 -Maximum 25)) }  # High\n    2 { [int]([Math]::Max(1, $selectedLab.refLow - (Get-Random -Minimum 3 -Maximum 15))) }  # Low\n  }\n  \n  # Additional data for other message types\n  # Appointment data with proper coded values for SIU messages\n  $appointmentTypes = @(\n    @{ code='CHECKUP'; display='Check-up' }\n    @{ code='FOLLOWUP'; display='Follow-up' }\n    @{ code='CONSULT'; display='Consultation' }\n    @{ code='PROCEDURE'; display='Procedure' }\n    @{ code='ROUTINE'; display='Routine Visit' }\n  )\n  $selectedApptType = $appointmentTypes[(Get-SecureRandomInt $appointmentTypes.Count)]\n  $d['appointmentId'] = Get-SecureRandomString 8\n  $d['appointmentFillerId'] = Get-SecureRandomString 10  # SCH-2 Filler Appointment ID\n  $apptStart = $now.AddDays([int](Get-SecureRandomInt 30)+1)\n  # Include timezone offset for enterprise compatibility (e.g., 20260225050600+0100)\n  $tzOffset = [System.TimeZoneInfo]::Local.GetUtcOffset($apptStart)\n  $tzSign = if ($tzOffset.TotalMinutes -ge 0) { '+' } else { '-' }\n  $tzFormatted = '{0}{1:D2}{2:D2}' -f $tzSign, [Math]::Abs($tzOffset.Hours), [Math]::Abs($tzOffset.Minutes)\n  $d['appointmentDateTime'] = $apptStart.ToString('yyyyMMddHHmmss') + $tzFormatted\n  $d['appointmentDuration'] = @('15','30','45','60')[(Get-SecureRandomInt 4)]\n  $d['appointmentEndDateTime'] = $apptStart.AddMinutes([int]$d['appointmentDuration']).ToString('yyyyMMddHHmmss') + $tzFormatted\n  $d['appointmentTypeCode'] = $selectedApptType.code\n  $d['appointmentTypeDisplay'] = $selectedApptType.display\n  $d['appointmentStatusCode'] = 'BOOKED'\n  $d['appointmentStatusDisplay'] = 'Booked'\n  # Medication data with matched dose/units/route/form for RDE messages\n  $medications = @(\n    @{ code='LISIN10'; name='Lisinopril 10mg'; dose='10'; units='mg'; form='TAB'; route='PO'; routeDisplay='Oral' }\n    @{ code='METF500'; name='Metformin 500mg'; dose='500'; units='mg'; form='TAB'; route='PO'; routeDisplay='Oral' }\n    @{ code='OMEP20'; name='Omeprazole 20mg'; dose='20'; units='mg'; form='CAP'; route='PO'; routeDisplay='Oral' }\n    @{ code='ATOR40'; name='Atorvastatin 40mg'; dose='40'; units='mg'; form='TAB'; route='PO'; routeDisplay='Oral' }\n    @{ code='AMLO5'; name='Amlodipine 5mg'; dose='5'; units='mg'; form='TAB'; route='PO'; routeDisplay='Oral' }\n    @{ code='CEFT1G'; name='Ceftriaxone 1g'; dose='1'; units='g'; form='INJ'; route='IV'; routeDisplay='Intravenous' }\n  )\n  $selectedMed = $medications[(Get-SecureRandomInt $medications.Count)]\n  $d['medicationCode'] = $selectedMed.code\n  $d['medicationName'] = $selectedMed.name\n  $d['medicationDose'] = $selectedMed.dose\n  $d['medicationUnits'] = $selectedMed.units\n  $d['medicationForm'] = $selectedMed.form\n  $d['medicationRoute'] = $selectedMed.route\n  $d['medicationRouteDisplay'] = $selectedMed.routeDisplay\n  # Frequency with proper coding\n  $frequencies = @(\n    @{ code='QD'; display='Once daily' }\n    @{ code='BID'; display='Twice daily' }\n    @{ code='TID'; display='Three times daily' }\n    @{ code='QID'; display='Four times daily' }\n    @{ code='Q8H'; display='Every 8 hours' }\n    @{ code='Q12H'; display='Every 12 hours' }\n  )\n  $selectedFreq = $frequencies[(Get-SecureRandomInt $frequencies.Count)]\n  $d['medicationFrequency'] = $selectedFreq.code\n  $d['medicationFrequencyDisplay'] = $selectedFreq.display\n  $d['medicationDuration'] = @('3','5','7','10','14','30')[(Get-SecureRandomInt 6)]\n  $d['rxFillerNumber'] = 'RX' + (Get-SecureRandomString 6)\n  \n  # Vaccine data for VXU messages (CVX codes)\n  $vaccines = @(\n    @{ cvx='208'; name='COVID-19, mRNA, LNP-S, PF, 30 mcg/0.3 mL dose'; mvx='PFR'; manufacturer='Pfizer'; dose='0.3'; units='mL' }\n    @{ cvx='207'; name='COVID-19, mRNA, LNP-S, PF, 100 mcg/0.5 mL dose'; mvx='MOD'; manufacturer='Moderna'; dose='0.5'; units='mL' }\n    @{ cvx='141'; name='Influenza, seasonal, injectable'; mvx='SKB'; manufacturer='GlaxoSmithKline'; dose='0.5'; units='mL' }\n    @{ cvx='33'; name='Pneumococcal polysaccharide PPV23'; mvx='MSD'; manufacturer='Merck'; dose='0.5'; units='mL' }\n    @{ cvx='21'; name='Varicella'; mvx='MSD'; manufacturer='Merck'; dose='0.5'; units='mL' }\n    @{ cvx='03'; name='MMR'; mvx='MSD'; manufacturer='Merck'; dose='0.5'; units='mL' }\n    @{ cvx='115'; name='Tdap'; mvx='PMC'; manufacturer='Sanofi Pasteur'; dose='0.5'; units='mL' }\n    @{ cvx='83'; name='Hepatitis A, ped/adol, 2 dose'; mvx='MSD'; manufacturer='Merck'; dose='0.5'; units='mL' }\n  )\n  $selectedVaccine = $vaccines[(Get-SecureRandomInt $vaccines.Count)]\n  $d['vaccineCvx'] = $selectedVaccine.cvx\n  $d['vaccineName'] = $selectedVaccine.name\n  $d['vaccineMvx'] = $selectedVaccine.mvx\n  $d['vaccineManufacturer'] = $selectedVaccine.manufacturer\n  $d['vaccineDose'] = $selectedVaccine.dose\n  $d['vaccineUnits'] = $selectedVaccine.units\n  $d['vaccineLotNumber'] = 'LOT' + (Get-SecureRandomString 6)\n  $d['vaccineExpiration'] = $now.AddYears(1).ToString('yyyyMMdd')\n  \n  # Financial transaction data for DFT messages\n  $transactionTypes = @(\n    @{ code='CG'; display='Charge' }\n    @{ code='CD'; display='Credit' }\n    @{ code='PY'; display='Payment' }\n  )\n  $d['transactionType'] = ($transactionTypes[(Get-SecureRandomInt $transactionTypes.Count)]).code\n  $d['transactionAmount'] = @('150.00','275.50','450.00','89.99','325.00','1250.00')[(Get-SecureRandomInt 6)]\n  $d['transactionId'] = 'TXN' + (Get-SecureRandomString 8)\n  # Document types with proper CE format for TXA-2\n  $documentTypes = @(\n    @{ code='DS'; display='Discharge Summary' }\n    @{ code='HP'; display='History and Physical' }\n    @{ code='OP'; display='Operative Report' }\n    @{ code='CN'; display='Consultation Note' }\n    @{ code='PN'; display='Progress Note' }\n    @{ code='CD'; display='Clinical Document' }\n  )\n  $selectedDocType = $documentTypes[(Get-SecureRandomInt $documentTypes.Count)]\n  $d['documentTypeCode'] = $selectedDocType.code\n  $d['documentTypeDisplay'] = $selectedDocType.display\n  # Document status codes per HL70271: AU=Authenticated, DI=Dictated, DO=Documented, IN=Incomplete, LA=Legally Authenticated\n  $documentStatuses = @(\n    @{ code='AU'; display='Authenticated' }\n    @{ code='LA'; display='Legally Authenticated' }\n    @{ code='DI'; display='Dictated' }\n    @{ code='IN'; display='Incomplete' }\n  )\n  $selectedDocStatus = $documentStatuses[(Get-SecureRandomInt $documentStatuses.Count)]\n  $d['documentStatusCode'] = $selectedDocStatus.code\n  $d['documentStatusDisplay'] = $selectedDocStatus.display\n  # Generate unique document ID (separate from message control ID)\n  $d['documentUniqueId'] = 'DOC' + (Get-SecureRandomString 8)\n  $d['documentDateTime'] = $now.ToString('yyyyMMddHHmmss') + $tzFormatted\n  $d['sendingApp'] = $inputSendingApp ?? 'XYOPS'\n  $d['sendingFacility'] = $inputSendingFacility ?? 'HOSPITAL'\n  $d['receivingApp'] = $inputReceivingApp ?? 'RECEIVER'\n  $d['receivingFacility'] = $inputReceivingFacility ?? 'CLINIC'\n  \n  Write-XYProgress 0.5 'Building HL7 message...'\n  \n  $segments = [System.Collections.Generic.List[string]]::new()\n  $segmentInfo = [System.Collections.Generic.List[object]]::new()\n  \n  # MSH - Message Header (always first)\n  # Include timezone offset in MSH-7 for enterprise compatibility\n  $mshTzOffset = [System.TimeZoneInfo]::Local.GetUtcOffset($now)\n  $mshTzSign = if ($mshTzOffset.TotalMinutes -ge 0) { '+' } else { '-' }\n  $mshTzFormatted = '{0}{1:D2}{2:D2}' -f $mshTzSign, [Math]::Abs($mshTzOffset.Hours), [Math]::Abs($mshTzOffset.Minutes)\n  $mshTimestamp = $now.ToString('yyyyMMddHHmmss') + $mshTzFormatted\n  # MSH-15: Accept Acknowledgment Type (AL=Always, NE=Never, ER=Error only)\n  # MSH-16: Application Acknowledgment Type (AL=Always, NE=Never, ER=Error only)\n  $msh = \"MSH|^~\\&|$($d.sendingApp)|$($d.sendingFacility)|$($d.receivingApp)|$($d.receivingFacility)|$mshTimestamp||$messageType^$eventType|$msgControlId|P|$version|||AL|AL\"\n  $segments.Add($msh)\n  $segmentInfo.Add(@('MSH', 'Message Header', 'Identifies sender, receiver, message type, and version'))\n  \n  # EVN - Event Type (recommended for ADT messages per HL7 v2.5.1)\n  if ($messageType -eq 'ADT') {\n    # EVN-1: Event Type Code (deprecated in v2.5, use MSH-9.2)\n    # EVN-2: Recorded Date/Time (required)\n    # EVN-3: Date/Time Planned Event (optional)\n    # EVN-4: Event Reason Code (optional)\n    # EVN-5: Operator ID (optional)\n    # EVN-6: Event Occurred (optional)\n    $evn = \"EVN|$eventType|$mshTimestamp\"\n    $segments.Add($evn)\n    $segmentInfo.Add(@('EVN', 'Event Type', \"Event: $eventType at $mshTimestamp\"))\n  }\n  \n  # PID - Patient Identification\n  # PID field positions (v2.5.1):\n  # PID-1: Set ID, PID-2: Patient ID (external, deprecated), PID-3: Patient Identifier List\n  # PID-4: Alternate Patient ID (deprecated), PID-5: Patient Name, PID-6: Mother's Maiden Name\n  # PID-7: Date/Time of Birth, PID-8: Administrative Sex\n  if ($messageType -in @('ADT','ORM','ORU','SIU','RDE','MDM','DFT','VXU')) {\n    $pidSeg = \"PID|1||$($d.patientId)^^^$($d.sendingFacility)^MR||$($d.patientLastName)^$($d.patientFirstName)||$($d.patientDOB)|$($d.patientGender)\"\n    $segments.Add($pidSeg)\n    $segmentInfo.Add(@('PID', 'Patient Identification', \"Patient: $($d.patientFirstName) $($d.patientLastName), MRN: $($d.patientId)\"))\n  }\n  \n  # PV1 - Patient Visit\n  # PV1 field positions (v2.5.1):\n  # PV1-1: Set ID, PV1-2: Patient Class (I/O/E/P/R/B/C/N/U)\n  # PV1-3: Assigned Patient Location (PL), PV1-4: Admission Type\n  # PV1-5: Preadmit Number, PV1-6: Prior Patient Location\n  # PV1-7: Attending Doctor (XCN), PV1-8: Referring Doctor\n  # ...\n  # PV1-19: Visit Number, PV1-44: Admit Date/Time, PV1-45: Discharge Date/Time\n  if ($messageType -in @('ADT','ORM','ORU','SIU','RDE','DFT')) {\n    # For SIU (scheduling), always default to Outpatient unless user explicitly set Inpatient or Emergency\n    $pv1Class = if ($messageType -eq 'SIU') {\n      if ($inputPatientClass -in @('I','E')) { $inputPatientClass } else { 'O' }\n    } else { $d.patientClass }\n    \n    # Build PV1 with proper field positioning\n    # PV1-7: Attending Doctor in XCN format (ID^Family^Given^Middle^Suffix^Prefix^Degree^Source)\n    $attendingXcn = \"$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)^^^DR\"\n    \n    if ($messageType -eq 'ADT') {\n      # For ADT, include visit number (PV1-19) and admit datetime (PV1-44)\n      # PV1|1|class|location||||attending||||||||||||||visitNumber||||||||||||||||||||||||admitDateTime|dischargeDateTime\n      # Using explicit field positions with proper separators\n      $pv1 = \"PV1|1|$pv1Class|$($d.assignedLocation)||||$attendingXcn||||||||||||$($d.visitNumber)|||||||||||||||||||||||$($d.admitDateTime)\"\n      if ($eventType -eq 'A03') {\n        # A03 (discharge) - add discharge datetime in PV1-45\n        $pv1 = \"PV1|1|$pv1Class|$($d.assignedLocation)||||$attendingXcn||||||||||||$($d.visitNumber)|||||||||||||||||||||||$($d.admitDateTime)|$($d.dischargeDateTime)\"\n      }\n    } else {\n      $pv1 = \"PV1|1|$pv1Class|$($d.assignedLocation)||||$attendingXcn\"\n    }\n    $segments.Add($pv1)\n    $segmentInfo.Add(@('PV1', 'Patient Visit', \"Class: $pv1Class, Location: $($d.assignedLocation)\"))\n  }\n  \n  # Message-specific segments\n  switch ($messageType) {\n    'ADT' {\n      # DG1 - Diagnosis (v2.5.1)\n      # DG1-1: Set ID\n      # DG1-2: Diagnosis Coding Method (deprecated)\n      # DG1-3: Diagnosis Code (CE) - code^description^coding system\n      # DG1-4: Diagnosis Description (deprecated, use DG1-3.2)\n      # DG1-5: Diagnosis Date/Time\n      # DG1-6: Diagnosis Type (A=Admitting, W=Working, F=Final)\n      # DG1-7 through DG1-15: various optional fields\n      # DG1-16: Diagnosing Clinician\n      $diagType = switch ($eventType) {\n        'A01' { 'A' }  # Admitting diagnosis\n        'A03' { 'F' }  # Final diagnosis (discharge)\n        'A04' { 'A' }  # Admitting diagnosis (registration)\n        default { 'W' }  # Working diagnosis\n      }\n      $dg1 = \"DG1|1||$($d.diagnosisCode)^$($d.diagnosisDescription)^I10||$mshTimestamp|$diagType||||||||||$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)\"\n      $segments.Add($dg1)\n      $segmentInfo.Add(@('DG1', 'Diagnosis', \"$($d.diagnosisCode) - $($d.diagnosisDescription) (Type: $diagType)\"))\n    }\n    'ORM' {\n      $orc = \"ORC|NW|$($d.orderNumber)||||||||||$($d.orderingProviderId)^$($d.orderingProviderName)\"\n      $segments.Add($orc)\n      $segmentInfo.Add(@('ORC', 'Common Order', \"Order: $($d.orderNumber)\"))\n      $obr = \"OBR|1|$($d.orderNumber)||$($d.observationId)^Complete Blood Count^LN|||$($d.orderDateTime)||||||||$($d.orderingProviderId)^$($d.orderingProviderName)\"\n      $segments.Add($obr)\n      $segmentInfo.Add(@('OBR', 'Observation Request', \"Test: $($d.observationId)\"))\n    }\n    'ORU' {\n      # OBR: Set ID | Placer Order # | Filler Order # | Universal Service ID | Priority | Req DateTime | Observation DateTime | ... | Ordering Provider | ... | Result Status\n      $obr = \"OBR|1|$($d.orderNumber)||$($d.observationId)^$($d.observationName)^LN|||$($d.observationDateTime)||||||||$($d.orderingProviderId)^$($d.orderingProviderName)||||||||F\"\n      $segments.Add($obr)\n      $segmentInfo.Add(@('OBR', 'Observation Request', \"Test: $($d.observationId) - $($d.observationName)\"))\n      # OBX: Set ID | Value Type | Observation ID | Sub-ID | Value | Units | Ref Range | Abnormal Flags | ... | Status | ... | DateTime\n      # Parse reference range to determine abnormal flag\n      $refParts = $d.observationRefRange -split '-'\n      [double]$refLow = $refParts[0]\n      [double]$refHigh = $refParts[1]\n      $abnormalFlag = if ([double]$d.observationValue -gt $refHigh) { 'H' } elseif ([double]$d.observationValue -lt $refLow) { 'L' } else { 'N' }\n      $obx = \"OBX|1|NM|$($d.observationId)^$($d.observationShortName)^LN||$($d.observationValue)|$($d.observationUnits)|$($d.observationRefRange)|$abnormalFlag|||$($d.observationStatus)|||$($d.observationDateTime)\"\n      $segments.Add($obx)\n      $segmentInfo.Add(@('OBX', 'Observation Result', \"Result: $($d.observationValue) $($d.observationUnits) (Ref: $($d.observationRefRange))\"))\n    }\n    'SIU' {\n      # SCH: Placer Appt ID | Filler Appt ID | Occurrence # | Placer Group # | Schedule ID | Event Reason | Appt Reason | Appt Type | Appt Duration | Duration Units | Appt Timing Qty | Placer Contact | ... | Filler Status\n      # SCH-1: Placer Appointment ID, SCH-2: Filler Appointment ID\n      # SCH-8: Appointment Type (CE) - code^display^coding system\n      # SCH-11: Appointment Timing Quantity (TQ) - ^^^startDateTime^endDateTime\n      # SCH-25: Filler Status Code (CE) - code^display^coding system\n      $sch = \"SCH|$($d.appointmentId)|$($d.appointmentFillerId)|||||$($d.appointmentTypeCode)^$($d.appointmentTypeDisplay)^HL70276|||^^^$($d.appointmentDateTime)^$($d.appointmentEndDateTime)||$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)||||$($d.appointmentStatusCode)^$($d.appointmentStatusDisplay)^HL70278\"\n      $segments.Add($sch)\n      $segmentInfo.Add(@('SCH', 'Scheduling Activity', \"Placer: $($d.appointmentId), Filler: $($d.appointmentFillerId)\"))\n      # AIS: Set ID | Segment Action | Universal Service ID | Start DateTime | Start Offset | Start Offset Units | Duration | Duration Units\n      $ais = \"AIS|1||$($d.appointmentTypeCode)^$($d.appointmentTypeDisplay)||$($d.appointmentDateTime)|$($d.appointmentDuration)|MIN\"\n      $segments.Add($ais)\n      $segmentInfo.Add(@('AIS', 'Appointment Info', \"Type: $($d.appointmentTypeDisplay), Duration: $($d.appointmentDuration) min\"))\n      # AIL: Set ID | Segment Action | Location Resource ID | Location Type | Location Group | Start DateTime | Start Offset | Start Offset Units | Duration | Duration Units | Allow Substitution | Filler Status\n      # Models the location as a schedulable resource\n      $ail = \"AIL|1||$($d.assignedLocation)||||||$($d.appointmentDuration)|MIN||$($d.appointmentStatusCode)^$($d.appointmentStatusDisplay)^HL70278\"\n      $segments.Add($ail)\n      $segmentInfo.Add(@('AIL', 'Appointment Location', \"Location: $($d.assignedLocation)\"))\n      # AIP: Set ID | Segment Action | Personnel Resource ID | Resource Type | Resource Group | Start DateTime | Start Offset | Start Offset Units | Duration | Duration Units | Allow Substitution | Filler Status\n      $aip = \"AIP|1||$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)|||||$($d.appointmentStatusCode)^$($d.appointmentStatusDisplay)^HL70278\"\n      $segments.Add($aip)\n      $segmentInfo.Add(@('AIP', 'Appointment Provider', \"Provider: $($d.attendingFirstName) $($d.attendingLastName)\"))\n    }\n    'RDE' {\n      # ORC: Order Control | Placer Order # | Filler Order # | Placer Group # | Status | ... | DateTime | ... | Ordering Provider\n      # ORC-5: IP=In Process (appropriate for new order NW), not CM=Completed\n      $orc = \"ORC|NW|$($d.orderNumber)||$($d.rxFillerNumber)|IP||||$mshTimestamp|$($d.orderingProviderId)^$($d.orderingProviderName)\"\n      $segments.Add($orc)\n      $segmentInfo.Add(@('ORC', 'Common Order', \"Placer: $($d.orderNumber), Status: In Process\"))\n      # RXE field positions (v2.5.1):\n      # RXE-1: Quantity/Timing (deprecated, use TQ1)\n      # RXE-2: Give Code (CE) - code^name^coding system\n      # RXE-3: Give Amount - Minimum\n      # RXE-4: Give Amount - Maximum (optional)\n      # RXE-5: Give Units (CE)\n      # RXE-6: Give Dosage Form (CE)\n      # RXE-7: Provider's Administration Instructions\n      # RXE-8: Deliver-To Location (deprecated)\n      # RXE-9: Substitution Status\n      # RXE-10: Dispense Amount\n      # RXE-11: Dispense Units\n      # RXE-12: Number of Refills\n      # RXE-13: Ordering Provider's DEA Number\n      # RXE-14: Pharmacist/Treatment Supplier's Verifier ID\n      # RXE-15: Prescription Number\n      # ... more fields ...\n      # RXE-22: Give Per (Time Unit)\n      # RXE-23: Give Rate Amount\n      # RXE-24: Give Rate Units\n      $rxe = \"RXE||^$($d.medicationCode)^$($d.medicationName)^L|$($d.medicationDose)||$($d.medicationUnits)^$($d.medicationUnits)^ISO+|$($d.medicationForm)^$($d.medicationForm)^HL70292|^$($d.medicationFrequency)^$($d.medicationFrequencyDisplay)^HL70335\"\n      $segments.Add($rxe)\n      $segmentInfo.Add(@('RXE', 'Pharmacy Encoded Order', \"$($d.medicationName) $($d.medicationDose)$($d.medicationUnits) $($d.medicationFrequency)\"))\n      # RXR: Route (required for RDE)\n      $rxr = \"RXR|$($d.medicationRoute)^$($d.medicationRouteDisplay)^HL70162\"\n      $segments.Add($rxr)\n      $segmentInfo.Add(@('RXR', 'Pharmacy Route', \"Route: $($d.medicationRouteDisplay)\"))\n    }\n    'MDM' {\n      # TXA field positions (v2.5.1):\n      # TXA-1: Set ID\n      # TXA-2: Document Type (CE) - code^display^coding system (HL70270)\n      # TXA-3: Document Content Presentation (ID) - TX=Text, FT=Formatted Text, etc.\n      # TXA-4: Activity Date/Time\n      # TXA-5: Primary Activity Provider Code\n      # TXA-6: Origination Date/Time\n      # TXA-7: Transcription Date/Time\n      # TXA-8: Edit Date/Time\n      # TXA-9: Originator Code/Name\n      # TXA-10: Assigned Document Authenticator\n      # TXA-11: Transcriptionist Code/Name\n      # TXA-12: Unique Document Number (EI) - should be different from MSH-10\n      # TXA-13: Parent Document Number\n      # TXA-14: Placer Order Number\n      # TXA-15: Filler Order Number\n      # TXA-16: Unique Document File Name\n      # TXA-17: Document Completion Status (ID) - HL70271\n      $txa = \"TXA|1|$($d.documentTypeCode)^$($d.documentTypeDisplay)^HL70270|TX|$($d.documentDateTime)||||||$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)||$($d.documentUniqueId)||||||$($d.documentStatusCode)\"\n      $segments.Add($txa)\n      $segmentInfo.Add(@('TXA', 'Document Header', \"Type: $($d.documentTypeDisplay), Doc ID: $($d.documentUniqueId), Status: $($d.documentStatusDisplay)\"))\n      # OBX for document content\n      # OBX-3: Use proper document content identifier, not the document type code\n      $obx = \"OBX|1|TX|DOC^Document Text||Patient presents with $($d.admitReason). Assessment and plan documented.||||||F\"\n      $segments.Add($obx)\n      $segmentInfo.Add(@('OBX', 'Document Content', 'Clinical note content'))\n    }\n    'DFT' {\n      # DFT^P03 - Post Detail Financial Transaction\n      # FT1 field positions (v2.5.1):\n      # FT1-1: Set ID\n      # FT1-2: Transaction ID\n      # FT1-3: Transaction Batch ID\n      # FT1-4: Transaction Date (required)\n      # FT1-5: Transaction Posting Date\n      # FT1-6: Transaction Type (CG=Charge, CD=Credit, PY=Payment)\n      # FT1-7: Transaction Code (CE) - procedure/charge code\n      # FT1-8: Transaction Description (deprecated)\n      # FT1-9: Transaction Description - Alt\n      # FT1-10: Transaction Quantity\n      # FT1-11: Transaction Amount - Extended\n      # FT1-12: Transaction Amount - Unit\n      # FT1-13: Department Code\n      # FT1-14: Insurance Plan ID\n      # FT1-15: Insurance Amount\n      # FT1-16: Assigned Patient Location\n      # FT1-17: Fee Schedule\n      # FT1-18: Patient Type\n      # FT1-19: Diagnosis Code - FT1 (CE)\n      # FT1-20: Performed By Code (XCN)\n      # FT1-21: Ordered By Code\n      # FT1-22: Unit Cost\n      # FT1-23: Filler Order Number\n      # FT1-24: Entered By Code\n      # FT1-25: Procedure Code (CE)\n      $ft1 = \"FT1|1|$($d.transactionId)||$mshTimestamp|$mshTimestamp|CG|99213^Office visit, established patient, level 3^CPT||||$($d.transactionAmount)||||||$($d.patientClass)||$($d.diagnosisCode)^$($d.diagnosisDescription)^I10|$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)||||||||99213^Office visit, established patient, level 3^CPT\"\n      $segments.Add($ft1)\n      $segmentInfo.Add(@('FT1', 'Financial Transaction', \"TXN: $($d.transactionId), Amount: \\$$($d.transactionAmount)\"))\n    }\n    'VXU' {\n      # VXU^V04 - Unsolicited Vaccination Record Update\n      # Required structure: MSH, PID, [PD1], {[NK1]}, [PV1], [PV2], [{IN1, [IN2], [IN3]}], {ORC, [RXA, [RXR], {[OBX]}]}\n      # ORC field positions (v2.5.1):\n      # ORC-1: Order Control (RE=Observations/Performed Service to Follow)\n      # ORC-2: Placer Order Number\n      # ORC-3: Filler Order Number\n      $orc = \"ORC|RE|$($d.orderNumber)|$($d.orderNumber)^$($d.sendingFacility)\"\n      $segments.Add($orc)\n      $segmentInfo.Add(@('ORC', 'Common Order', \"Order: $($d.orderNumber)\"))\n      # RXA field positions (v2.5.1):\n      # RXA-1: Give Sub-ID Counter (0 for historical, 1+ for administered)\n      # RXA-2: Administration Sub-ID Counter\n      # RXA-3: Date/Time Start of Administration (required)\n      # RXA-4: Date/Time End of Administration (required)\n      # RXA-5: Administered Code (CE) - CVX code^name^CVX\n      # RXA-6: Administered Amount (required)\n      # RXA-7: Administered Units (CE)\n      # RXA-8: Administered Dosage Form\n      # RXA-9: Administration Notes (CE)\n      # RXA-10: Administering Provider (XCN)\n      # RXA-11: Administered-at Location\n      # RXA-12: Administered Per (Time Unit)\n      # RXA-13: Administered Strength\n      # RXA-14: Administered Strength Units\n      # RXA-15: Substance Lot Number\n      # RXA-16: Substance Expiration Date\n      # RXA-17: Substance Manufacturer Name (CE) - MVX code\n      # RXA-18: Substance/Treatment Refusal Reason\n      # RXA-19: Indication\n      # RXA-20: Completion Status (CP=Complete, RE=Refused, NA=Not Administered, PA=Partially Administered)\n      # RXA-21: Action Code - RXA (A=Add, D=Delete, U=Update)\n      $rxa = \"RXA|0|1|$mshTimestamp|$mshTimestamp|$($d.vaccineCvx)^$($d.vaccineName)^CVX|$($d.vaccineDose)|$($d.vaccineUnits)^$($d.vaccineUnits)^UCUM||00^New immunization record^NIP001|$($d.attendingId)^$($d.attendingLastName)^$($d.attendingFirstName)||||$($d.vaccineLotNumber)|$($d.vaccineExpiration)|$($d.vaccineMvx)^$($d.vaccineManufacturer)^MVX|||CP|A\"\n      $segments.Add($rxa)\n      $segmentInfo.Add(@('RXA', 'Vaccine Administration', \"$($d.vaccineName) ($($d.vaccineDose) $($d.vaccineUnits))\"))\n      # RXR - Pharmacy/Treatment Route (recommended for vaccines)\n      # RXR-1: Route (CE) - HL70162\n      # RXR-2: Administration Site (CWE) - HL70163\n      $rxr = \"RXR|IM^Intramuscular^HL70162|LA^Left Arm^HL70163\"\n      $segments.Add($rxr)\n      $segmentInfo.Add(@('RXR', 'Pharmacy Route', 'Route: Intramuscular, Site: Left Arm'))\n      # OBX - Observation/Result (for vaccine eligibility, VIS dates, etc.)\n      # OBX-1: Set ID\n      # OBX-2: Value Type (CE=Coded Entry, DT=Date, NM=Numeric, etc.)\n      # OBX-3: Observation Identifier (CE)\n      # OBX-4: Observation Sub-ID\n      # OBX-5: Observation Value\n      # OBX-11: Observation Result Status (F=Final)\n      $obx = \"OBX|1|CE|64994-7^Vaccine funding program eligibility category^LN||V02^VFC eligible - Medicaid/Medicaid Managed Care^HL70064||||||F\"\n      $segments.Add($obx)\n      $segmentInfo.Add(@('OBX', 'Observation', 'Vaccine funding eligibility'))\n    }\n  }\n  \n  Write-XYProgress 0.8 'Saving HL7 file...'\n  \n  $hl7Message = $segments -join \"`r\"\n  $filename = \"hl7-$messageType-$eventType-$msgControlId.hl7\"\n  $outputPath = Join-Path $Cwd $filename\n  $hl7Message | Out-File -FilePath $outputPath -Encoding UTF8 -NoNewline\n  \n  Write-XYProgress 0.95 'Finalizing...'\n  \n  Write-XY @{ files = @($filename) }\n  Write-XY @{ table = @{ title='HL7 Message Segments'; header=@('Segment','Name','Description'); rows=$segmentInfo.ToArray(); caption=\"$messageType^$eventType message generated\" } }\n  Write-XY @{ text = @{ title='Raw HL7 Message'; content=$hl7Message; caption='' } }\n  \n  [pscustomobject]@{ tool='HL7 Generator'; messageType=$messageType; eventType=$eventType; version=$version; controlId=$msgControlId; segments=$segments.ToArray(); file=$filename; message=$hl7Message }\n}\n\n# ------------------------- HL7 Message Parser -------------------------\nfunction Invoke-HL7Parser {\n  param($Params, $JobInput, [string]$Cwd)\n  Write-XYProgress 0.1 'Validating parameters...'\n  \n  $source = ($Params.hl7ParserSource ?? 'field')\n  $hl7Input = ''\n  \n  if ($source -eq 'file') {\n    $filePath = ($Params.hl7FilePath ?? '')\n    if (-not $filePath) { throw 'No file path provided' }\n    $fullPath = if ([System.IO.Path]::IsPathRooted($filePath)) { $filePath } else { Join-Path $Cwd $filePath }\n    if (-not (Test-Path $fullPath)) { throw \"File not found: $filePath\" }\n    $hl7Input = Get-Content -Path $fullPath -Raw\n  } elseif ($source -eq 'bucket') {\n    # Check if JobInput exists and has data\n    # JobInput can be null, empty hashtable, or PSObject - need to handle all cases\n    $hasInputData = $false\n    $inputData = $null\n    \n    if ($null -ne $JobInput) {\n      if ($JobInput -is [hashtable]) {\n        if ($JobInput.ContainsKey('data') -and $null -ne $JobInput['data']) {\n          $inputData = $JobInput['data']\n          $hasInputData = $true\n        }\n      } elseif ($null -ne $JobInput.PSObject -and $null -ne $JobInput.PSObject.Properties -and ($JobInput.PSObject.Properties.Name -contains 'data')) {\n        $inputData = $JobInput.data\n        $hasInputData = ($null -ne $inputData)\n      }\n    }\n    \n    if (-not $hasInputData) {\n      throw 'Bucket data source selected but no input data available from previous job. Please run a job that outputs data to the bucket first, or select a different data source (text field or file).'\n    }\n    $path = (Get-Param $Params 'hl7ParserDataPath' '')\n    $val = if ($path.Trim()) { Get-NestedValue $inputData $path } else { $inputData }\n    if ($null -eq $val) { throw \"Data path '$path' not found in bucket data\" }\n    # Handle if bucket contains the message directly or in a 'message' field\n    if ($val -is [PSCustomObject] -or $val -is [hashtable]) {\n      # Try common field names using safe property access\n      $hl7Input = ''\n      foreach ($fieldName in @('message', 'hl7Message', 'hl7', 'content', 'data')) {\n        $hasField = if ($val -is [hashtable]) { $val.ContainsKey($fieldName) } else { $val.PSObject.Properties.Name -contains $fieldName }\n        if ($hasField) {\n          $fieldVal = $val.$fieldName\n          if ($fieldVal -and \"$fieldVal\".Trim()) {\n            $hl7Input = \"$fieldVal\"\n            break\n          }\n        }\n      }\n      if (-not $hl7Input) { throw \"Bucket data is an object but no 'message', 'hl7Message', 'hl7', 'content', or 'data' field found containing the HL7 message\" }\n    } else {\n      $hl7Input = [string]$val\n    }\n  } else {\n    $hl7Input = ($Params.hl7Input ?? '')\n  }\n  \n  if (-not $hl7Input.Trim()) { throw 'No HL7 message provided' }\n  \n  Write-XYProgress 0.3 'Parsing HL7 message...'\n  \n  $hl7Input = $hl7Input -replace \"`r`n\", \"`r\" -replace \"`n\", \"`r\"\n  $lines = $hl7Input.Trim() -split \"`r\" | Where-Object { $_.Trim() }\n  \n  if ($lines.Count -eq 0) { throw 'Empty HL7 message' }\n  \n  $mshLine = $lines[0]\n  if (-not $mshLine.StartsWith('MSH')) { throw 'HL7 message must start with MSH segment' }\n  \n  $fieldSep = $mshLine[3]\n  $compSep = $mshLine[4]\n  \n  $errors = [System.Collections.Generic.List[string]]::new()\n  $warnings = [System.Collections.Generic.List[string]]::new()\n  $parsedSegments = [System.Collections.Generic.List[object]]::new()\n  $segmentRows = [System.Collections.Generic.List[object]]::new()\n  \n  $segmentDefs = @{\n    'MSH' = @{ name='Message Header'; required=$true; fields=@('Encoding Characters','Sending Application','Sending Facility','Receiving Application','Receiving Facility','Date/Time','Security','Message Type','Control ID','Processing ID','Version') }\n    'EVN' = @{ name='Event Type'; required=$false; fields=@('Event Type Code','Recorded Date/Time','Planned Event Date/Time','Event Reason Code','Operator ID') }\n    'PID' = @{ name='Patient Identification'; required=$false; fields=@('Set ID','External ID','Internal ID','Alternate ID','Patient Name','Mother Maiden Name','DOB','Gender','Alias','Race','Address','County','Phone Home','Phone Business','Language','Marital Status','Religion','Account','SSN') }\n    'PV1' = @{ name='Patient Visit'; required=$false; fields=@('Set ID','Patient Class','Assigned Location','Admission Type','Preadmit Number','Prior Location','Attending Doctor','Referring Doctor','Consulting Doctor','Hospital Service') }\n    'PV2' = @{ name='Patient Visit Additional'; required=$false; fields=@('Prior Pending Location','Accommodation Code','Admit Reason','Transfer Reason','Patient Valuables','Patient Valuables Location','Visit User Code','Expected Admit Date','Expected Discharge Date') }\n    'DG1' = @{ name='Diagnosis'; required=$false; fields=@('Set ID','Coding Method','Diagnosis Code','Description','Date/Time','Type','Category','Related Group','Approval Indicator') }\n    'ORC' = @{ name='Common Order'; required=$false; fields=@('Order Control','Placer Order Number','Filler Order Number','Placer Group Number','Order Status','Response Flag','Quantity/Timing','Parent','Date/Time Transaction','Entered By','Verified By','Ordering Provider') }\n    'OBR' = @{ name='Observation Request'; required=$false; fields=@('Set ID','Placer Order Number','Filler Order Number','Universal Service ID','Priority','Requested Date/Time','Observation Date/Time','Observation End Date/Time','Collection Volume','Collector ID','Specimen Action Code','Danger Code','Clinical Info','Received Date/Time','Specimen Source','Ordering Provider') }\n    'OBX' = @{ name='Observation Result'; required=$false; fields=@('Set ID','Value Type','Observation ID','Sub-ID','Observation Value','Units','Reference Range','Abnormal Flags','Probability','Nature','Status','Effective Date','User Defined Access Checks','Date/Time Observation') }\n    'SCH' = @{ name='Scheduling Activity'; required=$false; fields=@('Placer Appointment ID','Filler Appointment ID','Occurrence Number','Placer Group Number','Schedule ID','Event Reason','Appointment Reason','Appointment Type','Appointment Duration','Duration Units') }\n    'AIS' = @{ name='Appointment Information'; required=$false; fields=@('Set ID','Segment Action Code','Universal Service ID','Start Date/Time','Start Offset','Start Offset Units','Duration','Duration Units','Allow Substitution Code','Filler Status Code') }\n    'RXE' = @{ name='Pharmacy Encoded Order'; required=$false; fields=@('Quantity/Timing','Give Code','Give Amount Minimum','Give Amount Maximum','Give Units','Give Dosage Form','Admin Instructions','Deliver-to Location') }\n    'RXA' = @{ name='Pharmacy Administration'; required=$false; fields=@('Give Sub-ID Counter','Admin Sub-ID Counter','Date/Time Start','Date/Time End','Administered Code','Administered Amount','Administered Units','Administered Dosage Form','Admin Notes','Administering Provider') }\n    'TXA' = @{ name='Transcription Document Header'; required=$false; fields=@('Set ID','Document Type','Content Presentation','Activity Date/Time','Primary Activity Provider','Origination Date/Time','Transcription Date/Time','Edit Date/Time','Originator Code','Assigned Document Authenticator') }\n    'FT1' = @{ name='Financial Transaction'; required=$false; fields=@('Set ID','Transaction ID','Transaction Batch ID','Transaction Date','Transaction Posting Date','Transaction Type','Transaction Code','Transaction Description','Transaction Quantity','Extended Amount') }\n  }\n  \n  Write-XYProgress 0.5 'Analyzing segments...'\n  \n  $messageType = ''; $eventType = ''; $version = ''; $controlId = ''\n  \n  foreach ($line in $lines) {\n    if (-not $line.Trim()) { continue }\n    \n    $segmentId = $line.Substring(0, [Math]::Min(3, $line.Length))\n    \n    $fields = if ($segmentId -eq 'MSH') {\n      @('MSH', $fieldSep) + ($line.Substring(4) -split [regex]::Escape($fieldSep))\n    } else {\n      $line -split [regex]::Escape($fieldSep)\n    }\n    \n    $segmentName = $segmentDefs[$segmentId]?.name ?? 'Unknown'\n    \n    if ($segmentId -eq 'MSH') {\n      if ($fields.Count -gt 9) {\n        $msgTypeParts = $fields[9] -split [regex]::Escape($compSep)\n        $messageType = $msgTypeParts[0]\n        $eventType = if ($msgTypeParts.Count -gt 1) { $msgTypeParts[1] } else { '' }\n      }\n      if ($fields.Count -gt 10) { $controlId = $fields[10] }\n      if ($fields.Count -gt 12) { $version = $fields[12] }\n      \n      if ($fields.Count -lt 12) { $errors.Add('MSH: Missing required fields (minimum 12 fields expected)') }\n      if (-not $messageType) { $errors.Add('MSH-9: Message type is required') }\n      if (-not $controlId) { $errors.Add('MSH-10: Control ID is required') }\n      if (-not $version) { $warnings.Add('MSH-12: Version ID is missing') }\n    }\n    \n    $fieldDetails = [System.Collections.Generic.List[object]]::new()\n    $fieldDefs = $segmentDefs[$segmentId]?.fields ?? @()\n    \n    for ([int]$i = 1; $i -lt $fields.Count; $i++) {\n      [int]$fieldIdx = $i - 1\n      $fieldName = if ($i -le $fieldDefs.Count) { $fieldDefs[$fieldIdx] } else { \"Field $i\" }\n      $fieldValue = $fields[$i]\n      if ($fieldValue) {\n        $fieldDetails.Add([pscustomobject]@{ index=$i; name=$fieldName; value=$fieldValue })\n      }\n    }\n    \n    $parsedSegments.Add([pscustomobject]@{\n      segment = $segmentId\n      name = $segmentName\n      fields = $fieldDetails.ToArray()\n      raw = $line\n    })\n    \n    $preview = if ($line.Length -gt 60) { $line.Substring(0, 60) + '...' } else { $line }\n    [int]$fieldCount = $fields.Count - 1\n    $segmentRows.Add(@($segmentId, $segmentName, $fieldCount, $preview))\n  }\n  \n  if (-not ($lines | Where-Object { $_.StartsWith('PID') })) {\n    $warnings.Add('PID segment is missing - no patient identification')\n  }\n  \n  Write-XYProgress 0.95 'Finalizing...'\n  \n  Write-XY @{ table = @{ title='HL7 Message Summary'; header=@('Property','Value'); rows=@(@('Message Type', \"$messageType^$eventType\"), @('Version', $version), @('Control ID', $controlId), @('Segments', $parsedSegments.Count), @('Errors', $errors.Count), @('Warnings', $warnings.Count)); caption=$(if ($errors.Count -eq 0) { 'Message parsed successfully' } else { 'Message has validation errors' }) } }\n  \n  Write-XY @{ table = @{ title='Segments'; header=@('Segment','Name','Fields','Preview'); rows=$segmentRows.ToArray(); caption='' } }\n  \n  if ($errors.Count -gt 0) {\n    Write-XY @{ table = @{ title='Errors'; header=@('#','Error'); rows=@(for ($n = 0; $n -lt $errors.Count; $n++) { ,@(($n + 1), $errors[$n]) }); caption='Validation errors found' } }\n  }\n  if ($warnings.Count -gt 0) {\n    Write-XY @{ table = @{ title='Warnings'; header=@('#','Warning'); rows=@(for ($n = 0; $n -lt $warnings.Count; $n++) { ,@(($n + 1), $warnings[$n]) }); caption='Validation warnings' } }\n  }\n  \n  foreach ($seg in $parsedSegments) {\n    if ($seg.fields.Count -gt 0) {\n      $fieldRows = $seg.fields | ForEach-Object {\n        [string]$valStr = \"$($_.value)\"\n        $val = if ($valStr.Length -gt 50) { $valStr.Substring(0, 50) + '...' } else { $valStr }\n        @(\"$($seg.segment)-$($_.index)\", $_.name, $val)\n      }\n      Write-XY @{ table = @{ title=\"$($seg.segment) - $($seg.name)\"; header=@('Field','Name','Value'); rows=$fieldRows; caption='' } }\n    }\n  }\n  \n  [pscustomobject]@{ tool='HL7 Parser'; messageType=$messageType; eventType=$eventType; version=$version; controlId=$controlId; segments=$parsedSegments.ToArray(); errors=$errors.ToArray(); warnings=$warnings.ToArray(); valid=($errors.Count -eq 0) }\n}\n\n# ------------------------- Main -------------------------\ntry {\n  $job = Read-JobFromStdin\n  $params = $job.params\n  $tool = if ($null -ne $params.PSObject -and $params.PSObject.Properties.Name -contains 'tool') { $params.tool } else { 'hl7Generator' }\n  $cwd = if ($null -ne $job.PSObject -and $job.PSObject.Properties.Name -contains 'cwd') { [string]$job.cwd } else { (Get-Location).Path }\n  $jobInput = if ($null -ne $job.PSObject -and $job.PSObject.Properties.Name -contains 'input') { $job.input } else { @{} }\n\n  $result = $null\n  switch ($tool) {\n    'hl7Generator' { $result = Invoke-HL7Generator -Params $params -JobInput $jobInput -Cwd $cwd }\n    'hl7Parser'    { $result = Invoke-HL7Parser -Params $params -JobInput $jobInput -Cwd $cwd }\n    default        { throw \"Unknown tool: $tool\" }\n  }\n\n  Write-XYSuccess -Data $result -Description (\"{0} completed successfully\" -f $result.tool)\n  [Console]::Out.Flush()\n  exit 0\n}\ncatch {\n  Write-XYError -Code 1 -Description ($_.Exception.Message)\n  [Console]::Out.Flush()\n  exit 1\n}",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "tool",
						"title": "Tool",
						"type": "toolset",
						"caption": "Select a healthcare tool.",
						"locked": false,
						"data": {
							"tools": [
								{
									"id": "hl7Generator",
									"title": "HL7 Message Generator",
									"description": "Generate valid HL7 v2.5.1 messages with fake or custom data.",
									"fields": [
										{
											"id": "hl7MessageType",
											"title": "Message Type",
											"type": "select",
											"value": "ADT - Admit/Discharge/Transfer [ADT], ORM - Order Message [ORM], ORU - Observation Result [ORU], SIU - Scheduling [SIU], RDE - Pharmacy Order [RDE], MDM - Medical Document [MDM], DFT - Financial Transaction [DFT], VXU - Vaccination Update [VXU]",
											"caption": "Select the HL7 message type to generate."
										},
										{
											"id": "hl7EventType",
											"title": "Event Type",
											"type": "select",
											"value": "A01 - Admit [A01], A02 - Transfer [A02], A03 - Discharge [A03], A04 - Register [A04], A05 - Pre-admit [A05], A08 - Update Patient [A08], A11 - Cancel Admit [A11], A13 - Cancel Discharge [A13], A28 - Add Person [A28], A31 - Update Person [A31], O01 - Order [O01], R01 - Result [R01], S12 - Notification [S12], T02 - Request [T02], P03 - Post Detail [P03], V04 - Vaccine Record [V04]",
											"caption": "Select the event type (primarily for ADT messages)."
										},
										{
											"id": "hl7DataSource",
											"title": "Data Source",
											"type": "select",
											"value": "Use form fields only [field], Use bucket data (form fields override) [bucket]",
											"caption": "Choose data source. Bucket data can be overridden by form fields below."
										},
										{
											"id": "hl7DataPath",
											"title": "Bucket Data Path",
											"type": "text",
											"value": "",
											"caption": "Optional dot-notation path prefix (e.g., 'hl7' reads from data.hl7.patientFirstName). Leave empty for root level."
										},
										{
											"id": "hl7PatientId",
											"title": "Patient ID (MRN)",
											"type": "text",
											"value": "",
											"caption": "Medical Record Number. Leave empty for random/bucket."
										},
										{
											"id": "hl7PatientFirstName",
											"title": "Patient First Name",
											"type": "text",
											"value": "",
											"caption": "Leave empty for random fake name."
										},
										{
											"id": "hl7PatientMiddleName",
											"title": "Patient Middle Name",
											"type": "text",
											"value": "",
											"caption": "Leave empty for none."
										},
										{
											"id": "hl7PatientLastName",
											"title": "Patient Last Name",
											"type": "text",
											"value": "",
											"caption": "Leave empty for random fake name."
										},
										{
											"id": "hl7PatientDOB",
											"title": "Patient Date of Birth",
											"type": "text",
											"value": "",
											"caption": "Format: YYYYMMDD (e.g., 19850315). Leave empty for random."
										},
										{
											"id": "hl7PatientGender",
											"title": "Patient Gender",
											"type": "select",
											"value": "Random [random], Male [M], Female [F], Other [O], Unknown [U]",
											"caption": "Patient's gender."
										},
										{
											"id": "hl7PatientSSN",
											"title": "Patient SSN",
											"type": "text",
											"value": "",
											"caption": "Format: 123-45-6789. Leave empty for random."
										},
										{
											"id": "hl7PatientRace",
											"title": "Patient Race",
											"type": "select",
											"value": "Random [random], White [2106-3], Black/African American [2054-5], Asian [2028-9], Native Hawaiian/Pacific Islander [2076-8], American Indian/Alaska Native [1002-5]",
											"caption": "CDC race code."
										},
										{
											"id": "hl7PatientMaritalStatus",
											"title": "Patient Marital Status",
											"type": "select",
											"value": "Random [random], Single [S], Married [M], Divorced [D], Widowed [W]",
											"caption": "Patient's marital status."
										},
										{
											"id": "hl7PatientAddress",
											"title": "Patient Street Address",
											"type": "text",
											"value": "",
											"caption": "Street address. Leave empty for random."
										},
										{
											"id": "hl7PatientCity",
											"title": "Patient City",
											"type": "text",
											"value": "",
											"caption": "City. Leave empty for random."
										},
										{
											"id": "hl7PatientState",
											"title": "Patient State",
											"type": "text",
											"value": "",
											"caption": "State code (e.g., NY, CA). Leave empty for random."
										},
										{
											"id": "hl7PatientZip",
											"title": "Patient ZIP Code",
											"type": "text",
											"value": "",
											"caption": "ZIP code. Leave empty for random."
										},
										{
											"id": "hl7PatientPhone",
											"title": "Patient Phone",
											"type": "text",
											"value": "",
											"caption": "Phone number. Leave empty for random."
										},
										{
											"id": "hl7AttendingId",
											"title": "Attending Physician ID",
											"type": "text",
											"value": "",
											"caption": "Provider ID. Leave empty for random."
										},
										{
											"id": "hl7AttendingFirstName",
											"title": "Attending Physician First Name",
											"type": "text",
											"value": "",
											"caption": "Leave empty for random."
										},
										{
											"id": "hl7AttendingLastName",
											"title": "Attending Physician Last Name",
											"type": "text",
											"value": "",
											"caption": "Leave empty for random."
										},
										{
											"id": "hl7VisitNumber",
											"title": "Visit/Encounter Number",
											"type": "text",
											"value": "",
											"caption": "Leave empty for random."
										},
										{
											"id": "hl7PatientClass",
											"title": "Patient Class",
											"type": "select",
											"value": "Random [random], Inpatient [I], Outpatient [O], Emergency [E], Preadmit [P]",
											"caption": "Patient classification."
										},
										{
											"id": "hl7AssignedLocation",
											"title": "Assigned Location",
											"type": "text",
											"value": "",
											"caption": "Format: ROOM^BED^FLOOR (e.g., ROOM101^BED1^FLOOR1). Leave empty for random."
										},
										{
											"id": "hl7AdmitDateTime",
											"title": "Admit Date/Time",
											"type": "text",
											"value": "",
											"caption": "Format: YYYYMMDDHHmm (e.g., 202601151030). Leave empty for current."
										},
										{
											"id": "hl7DischargeDateTime",
											"title": "Discharge Date/Time",
											"type": "text",
											"value": "",
											"caption": "Format: YYYYMMDDHHmm. Used for A03 discharge events. Leave empty for random future date."
										},
										{
											"id": "hl7AdmitReason",
											"title": "Admit Reason",
											"type": "text",
											"value": "",
											"caption": "Reason for admission. Leave empty for random."
										},
										{
											"id": "hl7DiagnosisCode",
											"title": "Diagnosis Code (ICD-10)",
											"type": "text",
											"value": "",
											"caption": "ICD-10 code (e.g., J18.9). Leave empty for random."
										},
										{
											"id": "hl7DiagnosisDescription",
											"title": "Diagnosis Description",
											"type": "text",
											"value": "",
											"caption": "Description of diagnosis. Leave empty for random."
										},
										{
											"id": "hl7SendingApp",
											"title": "Sending Application",
											"type": "text",
											"value": "",
											"caption": "Name of sending application. Default: XYOPS"
										},
										{
											"id": "hl7SendingFacility",
											"title": "Sending Facility",
											"type": "text",
											"value": "",
											"caption": "Name of sending facility. Default: HOSPITAL"
										},
										{
											"id": "hl7ReceivingApp",
											"title": "Receiving Application",
											"type": "text",
											"value": "",
											"caption": "Name of receiving application. Default: RECEIVER"
										},
										{
											"id": "hl7ReceivingFacility",
											"title": "Receiving Facility",
											"type": "text",
											"value": "",
											"caption": "Name of receiving facility. Default: CLINIC"
										}
									]
								},
								{
									"id": "hl7Parser",
									"title": "HL7 Message Parser",
									"description": "Parse, analyze, and validate HL7 v2.5.1 messages.",
									"fields": [
										{
											"id": "hl7ParserSource",
											"title": "Data Source",
											"type": "select",
											"value": "Use text field below [field], Load from file [file], Use bucket data [bucket]",
											"caption": "Choose where to get the HL7 message."
										},
										{
											"id": "hl7Input",
											"title": "HL7 Message",
											"type": "textarea",
											"value": "",
											"caption": "Paste your HL7 message here."
										},
										{
											"id": "hl7FilePath",
											"title": "File Path",
											"type": "text",
											"value": "",
											"caption": "Path to .hl7 file (when source is 'Load from file')."
										},
										{
											"id": "hl7ParserDataPath",
											"title": "Bucket Data Path",
											"type": "text",
											"value": "",
											"caption": "Dot-notation path to the HL7 message in bucket (e.g., 'hl7Message'). Leave empty for root level."
										}
									]
								}
							]
						}
					}
				],
				"notes": "",
				"icon": "hospital-building",
				"uid": "",
				"gid": "",
				"kill": "none",
				"runner": false
			}
		}
	]
}
